# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out )
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
update_fastlane
before_all do
  ENV['DEVELOPER_DIR'] = '/Applications/Xcode.app/Contents/Developer'
  skip_docs
  update_fastlane
  clear_derived_data
  git_pull
  #ensure_git_status_clean
end
default_platform(:ios)

platform :ios do
  lane :beta do
      xcodeproj = "./ios/rnapp.xcodeproj"
      increment_build_number(xcodeproj: './rnapp.xcodeproj')  
      add_git_tag
      gym(
          scheme: "rnapp", 
          workspace: "rnapp.xcworkspace",
          output_directory: "IPA_FOLDER",
          output_name: "cda-ios.ipa",
          include_bitcode: true,
          include_symbols: true,
          export_method: "app-store",
          export_options: "./fastlane/ExportOptions.plist"
        )
      match(type: "appstore")
      pilot(ipa: "./IPA_FOLDER/cda-ios.ipa")
      push_to_git_remote
      ifttt(
        api_key: "oj5xpv-jmZ9Y8jvUNCxAjwUyrX5YxTda5gVgLS8n-J6",
        event_name: "IOS_IPA_DONE",
        value1: "THIS IS GOOD "
      )
  end


  lane :crashlyticsbeta do
      increment_build_number(xcodeproj: './rnapp.xcodeproj')  
      gym(
          scheme: "rnapp", 
          workspace: "rnapp.xcworkspace",
          output_directory: "IPA_FOLDER",
          output_name: "cda-iosAdhoc.ipa",
          include_bitcode: true,
          include_symbols: true,
          export_options: {
            provisioningProfiles: { 
              "com.connorlarkin.CDA" => "match AdHoc com.connorlarkin.CDA",
            },
            "method": "ad-hoc",
          }
        )
      match(type: "adhoc")
      crashlytics(
          crashlytics_path: "./Pods/Crashlytics/submit", # path to your Crashlytics submit binary.
          api_token: "a2ec78e354f189482fccf90053282be4754c18d2",
          build_secret: "e2515682728fa92b8f7cff2cd790f5ca7295404f39c635ef7d8876fa283d597e",
          ipa_path: "./IPA_FOLDER/cda-iosAdhoc.ipa",
          groups: ['iOS-Testers']
        )
      ifttt(
        api_key: "oj5xpv-jmZ9Y8jvUNCxAjwUyrX5YxTda5gVgLS8n-J6",
        event_name: "IOS_IPA_DONE",
        value1: "THIS IS GOOD "
      )
  end
  
  lane :screenshots do
    capture_screenshots(workspace: "rnapp.xcworkspace", scheme: "FASTLANE SCREENSHOTS", number_of_retries: 3, concurrent_simulators: false)
    frame_screenshots(white: false)
    upload_to_app_store(skip_waiting_for_build_processing: true)
  end

end





